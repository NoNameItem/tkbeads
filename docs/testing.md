# Тестирование tkbeads

## Приоритеты

1. Уверенность в корректности логики
2. Предотвращение регрессий
3. Документация поведения через тесты

## Уровни тестирования

| Уровень | Что проверяем | Инструменты |
|---------|---------------|-------------|
| **Unit** | Data-слой (парсинг JSONL, модели), Store-слой (распределение по колонкам, blocked/ready) | pytest, фабрики |
| **Integration** | Сценарии пользователя: навигация, смена статуса, поиск | Textual pilot, временные файлы |
| **Snapshot** | Визуальное отображение: доска, модалки, состояния | pytest-textual-snapshot (SVG) |

## Тестовые данные

- **Фабрики** — для unit-тестов, создание Task с нужными параметрами
- **Файлы-фикстуры** — для integration/snapshot, готовые .jsonl сценарии

## Покрытие по версиям

Каждый вертикальный срез — самостоятельный релиз с полным покрытием.

| Версия | Unit | Integration | Snapshot |
|--------|------|-------------|----------|
| **V1 (MVP)** | loader, models, store (колонки) | навигация Tab/стрелки, выход q | пустая доска, доска с задачами |
| **V2 (Интерактивность)** | store.update_status, loader.save | модалка → смена статуса → файл | модалка деталей |
| **V3 (Иерархия)** | дерево, цепочки предков | сворачивание (Space, ←/→, Ctrl) | дерево, ребёнок с цепочкой |
| **V4 (Поиск)** | фильтрация, поиск по ID | `/`, `g`, `n/N` навигация | фильтр (dimmed задачи) |
| **V5 (Live updates)** | watcher | изменение файла → UI | — |

## Структура

```
tests/
├── conftest.py          # фабрики и общие фикстуры
├── fixtures/            # .jsonl для integration/snapshot
├── unit/
├── integration/
└── snapshots/
```

## Команды

```bash
pytest                    # все тесты
pytest tests/unit         # только unit
pytest --snapshot-update  # обновить снимки
```

## CI

- Запуск: ruff check → ty check → pytest
- Расхождение snapshot — сигнал проверить визуальные изменения
